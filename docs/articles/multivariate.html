<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivariate Smooth Terms • metagam</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate Smooth Terms">
<meta property="og:description" content="metagam">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metagam</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/dominance.html">Dominance analysis</a>
    </li>
    <li>
      <a href="../articles/heterogeneity.html">Heterogeneity analysis</a>
    </li>
    <li>
      <a href="../articles/multivariate.html">Multivariate smooth terms</a>
    </li>
    <li>
      <a href="../articles/pvals.html">Simultaneous confidence intervals and p-values</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Lifebrain/metagam/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multivariate_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multivariate Smooth Terms</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Lifebrain/metagam/blob/master/vignettes/multivariate.Rmd"><code>vignettes/multivariate.Rmd</code></a></small>
      <div class="hidden name"><code>multivariate.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lifebrain.github.io/metagam/">metagam</a></span><span class="op">)</span></code></pre></div>
<p>This vignette demonstrates how to meta-analyze multivariate smooth terms. In particular, we will focus on tensor interaction terms (<span class="citation">Wood (2006)</span>). We start by loading mgcv and generate five example datasets with somewhere between 100 and 1000 observations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; This is mgcv 1.8-38. For overview type 'help("mgcv-package")'.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html">gamSim</a></span><span class="op">(</span>eg <span class="op">=</span> <span class="fl">2</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">100</span><span class="op">:</span><span class="fl">1000</span>, <span class="fl">1</span><span class="op">)</span>, 
                                           verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<p>Here are the first few rows from the first dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">y</th>
<th align="right">x</th>
<th align="right">z</th>
<th align="right">f</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.3256550</td>
<td align="right">0.7883051</td>
<td align="right">0.1717434</td>
<td align="right">0.0481496</td>
</tr>
<tr class="even">
<td align="right">0.6593630</td>
<td align="right">0.4089769</td>
<td align="right">0.4547616</td>
<td align="right">0.4421995</td>
</tr>
<tr class="odd">
<td align="right">-1.9398972</td>
<td align="right">0.8830174</td>
<td align="right">0.7702048</td>
<td align="right">0.3101631</td>
</tr>
<tr class="even">
<td align="right">0.2502011</td>
<td align="right">0.9404673</td>
<td align="right">0.0626500</td>
<td align="right">0.0090102</td>
</tr>
<tr class="odd">
<td align="right">0.4023875</td>
<td align="right">0.0455565</td>
<td align="right">0.8150815</td>
<td align="right">0.1027516</td>
</tr>
<tr class="even">
<td align="right">0.0103863</td>
<td align="right">0.5281055</td>
<td align="right">0.3011425</td>
<td align="right">0.2731830</td>
</tr>
</tbody>
</table>
<div id="gams-with-tensor-interaction-terms" class="section level2">
<h2 class="hasAnchor">
<a href="#gams-with-tensor-interaction-terms" class="anchor"></a>GAMs with Tensor Interaction Terms</h2>
<p>We are interested in analyzing the joint effect of the explanatory variables x and z on the response y. This can be done using tensor interaction terms. We will illustrate this using the functions in the mgcv package before showing how individual participant data can be removed and the fits be meta-analyzed.</p>
<p>On the first dataset, we fit the following model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html">te</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">datasets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: gaussian </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; y ~ te(x, z)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)   </span>
<span class="co">#&gt; (Intercept)  0.24673    0.08726   2.828  0.00487 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;         edf Ref.df     F p-value  </span>
<span class="co">#&gt; te(x,z) 3.7  4.287 2.201  0.0605 .</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.0135   Deviance explained = 2.06%</span>
<span class="co">#&gt; GCV = 3.9497  Scale est. = 3.9135    n = 514</span></code></pre></div>
<p>We can visualize the term <code>te(x,z)</code> using <code>vis.gam</code>. See function <code>draw</code> from the <code>gratia</code> package for even more appealing visualizations. In this case there seems to be an interaction between x and z, hence making such a tensor interaction term useful.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/vis.gam.html">vis.gam</a></span><span class="op">(</span><span class="va">mod</span>, view <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"z"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"contour"</span><span class="op">)</span></code></pre></div>
<p><img src="multivariate_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="fitting-gams-with-tensor-interaction-terms-and-removing-rawdata" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-gams-with-tensor-interaction-terms-and-removing-rawdata" class="anchor"></a>Fitting GAMs with Tensor Interaction Terms and Removing Rawdata</h2>
<p>Now assume that a model of the form <code>y ~ te(x, z)</code> is to be fitted to data in the five locations for which we simulated above. We can replicate this here by first fitting the GAM and then calling <code><a href="../reference/strip_rawdata.html">strip_rawdata()</a></code> on the resulting objects:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">datasets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">{</span>
  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html">te</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
  <span class="fu"><a href="../reference/strip_rawdata.html">strip_rawdata</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Each element in the list <code>fits</code> now corresponds to a model without any individual participant data, which can be shared with a central location for meta-analysis. The summary method for the fits reproduces the summary output from the original <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">mgcv::gam()</a></code> fit.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; GAM stripped for individual participant data with strip_rawdata().</span>
<span class="co">#&gt; For meta-analysis of smooth terms, use the following identifiers: te(x,z).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Original output for gam object:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: gaussian </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; y ~ te(x, z)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)   </span>
<span class="co">#&gt; (Intercept)  0.24673    0.08726   2.828  0.00487 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;         edf Ref.df     F p-value  </span>
<span class="co">#&gt; te(x,z) 3.7  4.287 2.201  0.0605 .</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.0135   Deviance explained = 2.06%</span>
<span class="co">#&gt; GCV = 3.9497  Scale est. = 3.9135    n = 514</span></code></pre></div>
</div>
<div id="meta-analyzing-gams-with-tensor-interaction-terms" class="section level2">
<h2 class="hasAnchor">
<a href="#meta-analyzing-gams-with-tensor-interaction-terms" class="anchor"></a>Meta-Analyzing GAMs with Tensor Interaction Terms</h2>
<p>Assuming all GAM fits without individual participant data have been gathered in a single location and put a list named <code>fits</code> (which we did above), a meta-analytic can now be computed using <code><a href="../reference/metagam.html">metagam()</a></code>. If no grid is provided, <code><a href="../reference/metagam.html">metagam()</a></code> sets up a grid in which the argument <code>grid_size</code> determines the number of unique values of each term. Using the default <code>grid_size = 100</code> in this case means that the grid has 100 x 100 = 10,000 rows. Performing meta-analysis at each of these points might take a few moments, so we set <code>grid_size = 20</code> to get a first rough estimate.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metafit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metagam.html">metagam</a></span><span class="op">(</span><span class="va">fits</span>, grid_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>The summary method prints out the p-values of the smooth terms:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">metafit</span><span class="op">)</span>
<span class="co">#&gt; Meta-analysis of GAMs from 5 cohorts, using method FE.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Smooth terms analyzed: te(x,z).</span></code></pre></div>
<p>We can then plot the corresponding meta-analytic fit:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">metafit</span><span class="op">)</span></code></pre></div>
<p><img src="multivariate_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Wood2006" class="csl-entry">
Wood, Simon N. 2006. <span>“Low-Rank Scale-Invariant Tensor Product Smooths for Generalized Additive Mixed Models.”</span> <em>Biometrics</em> 62 (4): 1025–36. <a href="https://doi.org/10.1111/j.1541-0420.2006.00574.x">https://doi.org/10.1111/j.1541-0420.2006.00574.x</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Oystein Sorensen, Andreas M. Brandmaier, Athanasia Mo Mowinckel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
